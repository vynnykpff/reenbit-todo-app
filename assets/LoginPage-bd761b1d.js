import{R as d,K as i,M as P,O as I,l as L,d as x,u as T,g as y,r as b,j as t,L as A,P as B,w as m,Q as p,S,I as R,B as F,U as v,a as M}from"./index-956c5834.js";import{a as O}from"./api-962931bd.js";class H{static async setLogin({email:s,password:n}){return(await O.post(`/users${d.LOGIN}`,{email:s,password:n})).data}}function G({email:a,password:s}){return async function(n){n({type:i.AUTH_PENDING,payload:!0});const o=await H.setLogin({email:a,password:s});if(typeof o=="string"){n({type:i.AUTH_ERROR,payload:o});return}n({type:i.AUTH_SUCCESS,payload:o==null?void 0:o.user}),localStorage.setItem("access-token",o.accessToken)}}var g=(a=>(a[a.MAX_PASSWORD_LENGTH=16]="MAX_PASSWORD_LENGTH",a[a.MIN_PASSWORD_LENGTH=6]="MIN_PASSWORD_LENGTH",a))(g||{}),_=(a=>(a.INVALID_EMAIL="Invalid email",a.MAX_LENGTH="Must be at most 16 characters",a.MIN_LENGTH="Must be at least 6 characters",a))(_||{});const D=P().shape({email:I().email(_.INVALID_EMAIL).required(L.REQUIRED_FIELD),password:I().max(g.MAX_PASSWORD_LENGTH,_.MAX_LENGTH).min(g.MIN_PASSWORD_LENGTH,_.MIN_LENGTH).required(L.REQUIRED_FIELD)}),w="_authForm_3zb5r_1",z="_authFieldContainer_3zb5r_6",k="_authInputContainer_3zb5r_12",U="_authFieldError_3zb5r_19",W="_authLabel_3zb5r_23",X="_authInput_3zb5r_12",$="_authFormNavigationContainer_3zb5r_39",Q="_formButton_3zb5r_43",q="_authButton_3zb5r_51",K="_resetButton_3zb5r_55",J="_testError_3zb5r_60",e={authForm:w,authFieldContainer:z,authInputContainer:k,authFieldError:U,authLabel:W,authInput:X,authFormNavigationContainer:$,formButton:Q,authButton:q,resetButton:K,testError:J},Y=()=>{const a=x(),s=T(),{error:n,isPending:o,user:h}=y(r=>r.authReducer);b.useEffect(()=>{h!=null&&h._id&&localStorage.getItem("access-token")&&s(d.HOME),a({type:i.RESET_ERROR})},[h]);const C=async r=>{a(G({...r}))},j=r=>{r(),a({type:i.RESET_ERROR})};return t.jsx("form",{className:e.authForm,children:o?t.jsx(A,{}):t.jsx(B,{initialValues:{email:"",password:""},validationSchema:D,onSubmit:C,children:({handleSubmit:r,handleBlur:N,resetForm:f})=>t.jsxs("div",{className:e.authFieldContainer,children:[t.jsx("span",{className:m(p.modalError,e.authFieldError,e.testError),children:n}),t.jsx(S,{name:"email",children:({field:l,meta:c})=>t.jsxs("fieldset",{className:e.authInputContainer,children:[t.jsx("label",{className:e.authLabel,htmlFor:"email",children:"Email"}),t.jsx(R,{...l,className:e.authInput,id:"email",type:"email",placeholder:"Email",onBlur:u=>{l.onBlur(u),N(u)}}),t.jsx("span",{className:m(p.modalError,e.authFieldError),children:c.touched&&c.error})]})}),t.jsx(S,{name:"password",children:({field:l,meta:c})=>t.jsxs("fieldset",{className:e.authInputContainer,children:[t.jsx("label",{className:e.authLabel,htmlFor:"password",children:"Password"}),t.jsx(R,{...l,className:e.authInput,type:"password",id:"password",placeholder:"Password",onBlur:u=>{l.onBlur(u),N(u)}}),t.jsx("span",{className:m(p.modalError,e.authFieldError),children:c.touched&&c.error})]})}),t.jsxs("div",{className:e.authFormNavigationContainer,children:[t.jsx(F,{disabled:o,onClick:()=>j(f),className:m(e.formButton,e.resetButton),children:"Reset"}),t.jsx(F,{disabled:o,onClick:()=>r(),className:m(e.formButton,e.authButton),children:"Login"})]})]})})})},Z="_loginFormContainer_a82po_1",V="_loginPageTitle_a82po_12",tt="_loginPageContainer_a82po_19",E={loginFormContainer:Z,loginPageTitle:V,loginPageContainer:tt},ot=()=>{const a=localStorage.getItem("access-token"),s=T(),n=v(),o=x();return b.useEffect(()=>{if(a){s(d.HOME);return}s(d.LOGIN),o({type:i.RESET_USER}),o({type:M.RESET_TODOS})},[n.pathname]),a?null:t.jsx("div",{className:E.loginPageContainer,children:t.jsxs("div",{className:E.loginFormContainer,children:[t.jsx("h4",{className:E.loginPageTitle,children:"Login"}),t.jsx(Y,{})]})})};export{ot as default};
